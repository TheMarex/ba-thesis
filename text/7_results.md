# Experimental Evaluation

To test the performance of the stabilizer against simple pattern playback,
both walking straight and walking in circle where tested.
To simulate further disturbances, the simulation shoots a football at the robot.
In the unstabilized case, only the joint trajectory that is generated by the pattern generator is interpolated
and replayed. In the stabilized case the alternative stabilizer described in section
\ref{section:alternative-approach} is used.

## Undisturbed walking

### Walking in a straight line

The first scenario is walking in a straight line for 10 steps.
Figure \ref{img:player-undisturbed-straight-thumbs} shows the simulation of walking straight for 10 steps using no stabilization.

\begin{figure}[H]
\vspace*{-1em}
\includegraphics[width=\textwidth]{images/undisturbed_straight_thumbs.png}
\caption{Frames of undisturbed straight walking}
\label{img:player-undisturbed-straight-thumbs}
\end{figure}

\begin{figure}[H]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/undisturbed_straight_x.png}
\caption{CoM and ZMP as specified by the pattern (top) and actual realized values (middle and bottom).
All coordinates in the global reference frame.}
\label{img:undisturbed-straight-x}
\end{figure}

Figure \ref{img:undisturbed-straight-x} shows the desired and realized CoM and ZMP trajectories
in both cases. As you can see the ZMP deviates significantly from the desired trajectory
and oscillates between both edges of the support polygon. We believe this is caused by the problems
outlined in section \ref{section:rigid-body-simulation}. Consider figure \ref{img:noisy-com-acc} which shows
the desired CoM acceleration in comparison to the realized acceleration.

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/noisy_com_acc.png}
\caption{Acceleration of the CoM in $x$-direction.}
\label{img:noisy-com-acc}
\end{figure*}

However the foot remains in full ground contact and friction forces are applied accurately.
Thus dynamically stable walking is realized for both unstabilized and stabilized walking.
See figure \ref{img:contact_forces} for the contact forces that are applied to each foot while walking.
The forces oscillate quite a bit due to simulation error. However the mean values meet the expectations
of the gravity force vector.

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/contact_forces.png}
\caption{Contact forces in $z$ direction for both feet.}
\label{img:contact_forces}
\end{figure*}

Figure \ref{img:ankle-torques} depicts the ankle torques that are applied to each feet.
Please note the rapid change in sign during single support. We believe this is caused
by \name{Bullet}s method of applying contact forces. Contact forces are always applied
to the contact point with the deepest penetration into the floor. In flat ground contact
the penetration depth of contact points on the edge of the support polygon is almost the same.
Small errors lead \name{Bullet} to alternate between contact points on opposite sides of
the support polygon.
We hope that a more stable Featherstone constraint solver will produce more accurate contact forces and ankle torques.

\begin{figure}[H]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/ankle_torques.png}
\caption{Ankle torques along the $x$ and $y$ axis for both feet.}
\label{img:ankle-torques}
\end{figure}

An interesting way to compare the trajectory executed by \name{Armar 4} to walking in humans
is to use the angular momentum around the CoM. See figure \ref{img:sophie-angular-momentum}
for the angular momentum trajectories as measured in test subjects by Laturnus \cite{laturnus2014} in her Bachelor's Thesis.
Note the similarities to the angular momentum that is realized in the simulation in figure \ref{img:angular-momentum}

\begin{figure}[H]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/sophie_angular_momentum.png}
\caption{The angular momentum as measured on test subjects for straight walking by Laturnus \cite{laturnus2014}}
\label{img:sophie-angular-momentum}
\end{figure}

\begin{figure}[H]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/angular_momentum.png}
\caption{The angular momentum as measured in the simulation while walking straight.}
\label{img:angular-momentum}
\end{figure}

Immediately clear are the more pronounced sharp minima and maxima of the $y$-component of the angular momentum.
This is probably caused by the missing toe/heel lift-off and strike down phases, as the foot is kept parallel to the floor at all times.

### Walking in a circle

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/undisturbed_circle_thumbs.png}
\caption{\name{Armar4} walking in a half circle in 12 steps.}
\label{img:player-undisturbed-circle-thumbs}
\end{figure*}

Figure \ref{img:player-undisturbed-circle-thumbs} shows the simulation of unstabilized walking in a circle.
The robot walks in 12 steps in an arc of 180° and 0.5 m radius.
As you can see the desired 180° turn is not realized completely. Due to the
chest rotation following the tangent of the circle, a torque around the yaw-axis is exerted on the foot.
Recall that during pattern generation we assumed that this torque is zero. Since we do not correct this
disturbance the trajectory deviates significantly.
See figure \ref{img:undisturbed-circle} for the realized ZMP distribution and CoM trajectory for
both unstabilized and stabilized walking. The unstabilized trajectory will get unstable towards
the end of the trajectory. However the stabilized trajectory remains stable.

\begin{figure}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/undisturbed_circle.png}
\caption{Walking in a cricle. ZMP (left) and CoM (right) as specified by the pattern and the actually realized values.
Each for the unstabilized and stabilized case.}
\label{img:undisturbed-circle}
\end{figure}

## Disturbed walking

The scenario used to test the performance of the stabilizer under disturbance,
was applying a short push to the chest, back, left shoulder and right shoulder.
The results are compared with the performance of the unstabilized trajectory.

\begin{figure}[H]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/disturbed_straight_thumbs.png}
\caption{\name{Armar4} getting hit by a ball at chest height. Red arrows show approximate direction of the ball velocity vector.}
\label{img:player-undisturbed-circle-thumbs}
\end{figure}

To simulate a push, a ball with a radius of 11cm and weight of 450g (FIFA football) is shoot from
1 meter distance at the chest.
See figure \ref{img:disturbed-front-straight-x} for the realized CoM and ZMP trajectories. The point of impact is denoted as red lines.
The unstabilized trajectory becomes unstable and leads to a fall at $t = 7s$. The stabilized
trajectory is noticeable disturbed, as the yaw momentum is not compensated, but remains stable.

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/disturbed_front_straight_x.png}
\caption{The actually realized CoM and ZMP values after a ball collision in the chest.
All coordinates in the global reference frame. Red lines denote the point of impact.}
\label{img:disturbed-front-straight-x}
\end{figure*}

Figure \ref{img:disturbed-back-straight-x} shows the realized ZMP and CoM after an impact in the back.
The unstabilized trajectory does not lead to falling in this case, but the trajectory of the ZMP indicates a rather
unstable trajectory.

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/disturbed_back_straight_x.png}
\caption{The actually realized CoM and ZMP values after a ball collision in the back.
All coordinates in the global reference frame. Red lines denote the point of impact.}
\label{img:disturbed-back-straight-x}
\end{figure*}

Similar results can be observed for disturbances on the left (see figure \ref{img:disturbed-left-straight-x})
and right shoulder (see figure \ref{img:disturbed-right-straight-x}). In both cases the disturbance leads to falling
in the unstabilized case.
Figure \ref{img:cp-disturbance-front-y} show the impact of the push to the chest on the immediate capture point.
The capture point shifts rapidly in the direction of the disturbance. This property
will be utilized to derive a capture position for push recovery.

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/disturbed_left_straight_x.png}
\caption{The actually realized CoM and ZMP values after a ball collision in the left shoulder.
All coordinates in the global reference frame. Red lines denote the point of impact.}
\label{img:disturbed-left-straight-x}
\end{figure*}


\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/disturbed_right_straight_x.png}
\caption{The actually realized CoM and ZMP values after a ball collision in the right shoulder.
All coordinates in the global reference frame. Red lines denote the point of impact.}
\label{img:disturbed-right-straight-x}
\end{figure*}


\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/cp_disturbance_front_y.png}
\caption{Impact of the disturbance on the immediate capture point. Red lines denote the point of impact.}
\label{img:cp-disturbance-front-y}
\end{figure*}

## Push recovery

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/push_recovery_thumbs.png}
\caption{\name{Armar4} getting hit by two balls at the left shoulder.}
\label{img:push-recovery-thumbs}
\end{figure*}

The performance of the push recovery was evaluated with a simple best-case scenario.
The robot is balancing on the left foot and is pushed on the right shoulder.
Most notably this scenario was used to demonstrate the push recovery based on the Capture Point
implemented in the IHMC/Yobotics Biped. \cite{pratt2009video}.
While the push recovery implemented is able to recover from any position,
with the current method it is not reliable in the general case.
There are multiple reasons for this. For one, the fall detection is not very reliable.
Another reason is that the speed limits of the leg joints impose a maximum velocity
for the foot movement. So not only needs the target position to be reachable, it also
needs to be reachable in a specific amount of time.
As above a football is used as source of disturbance.
See figure \ref{img:push-recovery-thumbs} shows a push recovery from being pushed from the left shoulder.

See figure \ref{img:push-recovery-x} for a trajectory of the recovery maneuver. You can see
that the Immediate Capture Point jumps at the point of impact. The push recovery is activated
$0.3s$ after the impact as the fall detection threshold is reached.
You can see that the foot does not reach the desired $x$-coordinate. This is caused by the capture foot hitting
the floor earlier than planned. However the capture point is successfully moved back into the support polygon.

\begin{figure*}[hbt]
\vspace*{-1em}
\includegraphics[width=\textwidth,resolution=300]{images/push_recovery_x.png}
\caption{Recovery maneuver as executed for a push on the left shoulder while standing on the left foot.}
\label{img:push-recovery-x}
\end{figure*}
